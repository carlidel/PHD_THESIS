\usepackage[LGR,T1]{fontenc}
\usepackage[utf8]{inputenc}

\newcommand{\textgreek}[1]{\begingroup\fontencoding{LGR}\selectfont#1\endgroup}

\newcommand\hmmax{0}
\newcommand\bmmax{0}

\usepackage{titlesec, blindtext, xcolor}
\definecolor{gray75}{gray}{0.75}
\definecolor{unibo}{RGB}{187, 46, 41}
\newcommand{\hsp}{\hspace{20pt}}
\newcommand{\hsps}{\hspace{10pt}}
\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{unibo}{|}\hsp}{0pt}{\Huge\bfseries}
\titleformat{\section}[hang]{\Large\bfseries}{\thesection\hsps\textcolor{unibo}{|}\hsps}{0pt}{\Large\bfseries}
\titleformat{\subsection}[hang]{\large\bfseries}{\thesubsection\hsps\textcolor{unibo}{|}\hsps}{0pt}{\large\bfseries}

\usepackage[french,italian,english]{babel}
\usepackage{physics}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{bm}% bold math
\usepackage{graphicx}
\usepackage{multirow}
%\usepackage[pdf]{pstricks}
%\usepackage{ps4pdf} \PSforPDF{ \usepackage{pstricks} }
%\usepackage{pst-pdf}
%\usepackage{epstopdf}
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}


\newcommand{\opm}[1]{{\color{red}#1}}
\newcommand{\av}[1]{\left<{#1}\right>}
\newcommand{\ie}{i.e.\ }
\newcommand{\Ie}{I.e.\ }
\newcommand{\eg}{e.g.\ }
\newcommand{\etc}{etc.\ }
\newcommand{\Eg}{E.g.\ } 
\newcommand{\viz}{\textit{viz.}\ } 
\newcommand{\resp}{resp.\ }
\newcommand{\wrt}{w.r.t.\ }
\newcommand{\cf}{cf.\ }
\newcommand{\lhs}{l.h.s.\ }
\newcommand{\rhs}{r.h.s.\ }
\newcommand{\ed}{\, .}
\newcommand{\ec}{\, ,}
\newcommand{\ham}{\mathcal{H}}
\newcommand{\map}{\mathcal{M}}
\newcommand{\eps}{\varepsilon}
\newcommand{\Eta}{\mathrm{H}}
\newcommand{\phii}[1]{\phi_{#1,\text{i}}}
\newcommand{\pr}{P}
\newcommand{\Ji}[1]{J_{#1,\text{i}}}
\newcommand{\Jf}[1]{J_{#1,\text{f}}}
\newcommand{\epsm}{\eps_\text{m}}
\newcommand{\epsmi}{\eps_\text{m,i}}
\newcommand{\epsmf}{\eps_\text{m,f}}
\newcommand{\epsh}{\eps_\text{h}}
\newcommand{\epshi}{\eps_\text{h,i}}
\newcommand{\epshf}{\eps_\text{h,f}}
\newcommand{\ScaleFig}{1.5}

%\usepackage[rmargin=]{geometry}
\newcommand{\dt}{\dot}
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}
%\newcommand{\av}[1]{\left<#1\right>}
\newcommand{\bfield}{\mathbf{B}}
\newcommand{\ph}{\varphi}
\newcommand{\lap}{\nabla^2}
%\renewcommand{\grad}{\nabla}
%\renewcommand{\div}{\nabla\cdot}
\newcommand{\rot}{\curl}
\newcommand{\img}{\mathrm{i}}
\usepackage[pdftex,bookmarks=true,bookmarksopen=true,bookmarksnumbered=true,pdfdisplaydoctitle=true,hidelinks]{hyperref}
\usepackage[separate-uncertainty=true]{siunitx}
\DeclareSIUnit\clight{\text{\ensuremath{c}}}

\usepackage{epigraph}
\usepackage{bookmark}

\usepackage{csquotes}
\usepackage[style=numeric-comp, giveninits=true,maxcitenames=10,maxbibnames=4, sorting=none]{biblatex}

\renewcommand*{\mkbibnamegiven}[1]{\textsc{#1}}
\renewcommand*{\mkbibnamefamily}[1]{\textsc{#1}}

%giustificazione epigrafi
\renewcommand{\textflush}{flushright}
%\renewcommand{\epigraphflush}{flushright}

\usepackage{pgf,tikz,pgfplots}
%\pgfplotsset{compat=1.15}
%\usepackage{mathrsfs}
%\usetikzlibrary{arrows}
\usepackage{tikz-cd}
\usetikzlibrary{3d,arrows}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{arrows.meta, bending, calc}
\pgfplotsset{compat=1.15}
%\usepackage{gnuplot-lua-tikz}
\usepackage[labelfont={sc, color=unibo},font={small}]{caption}
\usepackage{subcaption}
%\captionsetup[subfigure]{labelfont=rm}
\usepackage{indentfirst}

\usepackage{hvfloat}

%%%%FONT
\usepackage[p,osf,sups]{baskervillef}
%\usepackage[lf]{Baskervaldx}
\usepackage[varqu,varl,var0]{inconsolata}
\usepackage[scale=.95,type1]{cabin}
\usepackage[baskerville,vvarbb]{newtxmath}
\usepackage[cal=boondoxo]{mathalfa}

\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}
\fancyhf{}
\fancyhead[RO,LE]{\bfseries\thepage}
\fancyhead[LO]{\nouppercase{\itshape\rightmark}}
\fancyhead[RE]{\nouppercase{\scshape\leftmark}}
\renewcommand{\headrulewidth}{0.5pt}
%\renewcommand{\footrulewidth}{0.5pt}
%\addtolenght{\headheight}{0.5pt}
\fancypagestyle{plain}{
	\fancyhead{}
	\renewcommand{\headrulewidth}{0pt}
}

\usepackage{xpatch}
\xpretocmd\headrule{\color{unibo}}{}{\PatchFailed}

\makeatletter
\renewcommand{\@epirule}{{\color{unibo} \rule[.5ex]{\epigraphwidth}{\epigraphrule}}}
\makeatother
% %\makeatletter

%\newcommand\frontmatter{%
%    \cleardoublepage
%  \@mainmatterfalse
%  \pagenumbering{roman}}

%\newcommand\mainmatter{%
%    \cleardoublepage
%  \@mainmattertrue
%  \pagenumbering{arabic}}

%\newcommand\backmatter{%
%  \if@openright
%      \cleardoublepage
%  \else
%    \clearpage
%  \fi
%  \@mainmatterfalse
%  }

%\makeatother

%\usepackage{newlfont}
\usepackage{color}
%\textwidth=450pt\oddsidemargin=0pt

% % %et al. in corsivo$
\renewbibmacro*{name:andothers}{% Based on name:andothers from biblatex.def
  \ifboolexpr{
    test {\ifnumequal{\value{listcount}}{\value{liststop}}}
    and
    test \ifmorenames
  }
    {\ifnumgreater{\value{liststop}}{1}
       {\finalandcomma}
       {}%
     \andothersdelim\bibstring[\emph]{andothers}}
    {}}
\renewbibmacro{in:}{}

\usepackage{rotating}
%\usepackage{subfig}

\usepackage{multirow}
\def\block(#1,#2)#3{\multicolumn{#2}{c}{\multirow{#1}{*}{$ #3 $}}}
\allowdisplaybreaks[1]

\usepackage{pgfornament}

\makeatletter
\newcommand{\ifenoughspace}[3]{%
  \@tempdimc\pagegoal \advance\@tempdimc-\pagetotal%
  \ifdim #1>\@tempdimc #3 \else #2\fi}


\newcommand{\parseparator}{\par{}\begin{center}\begin{tikzpicture}\node{\pgfornament[color=unibo,height=1em]{84}};\end{tikzpicture}\end{center}\par{} }

\newcommand{\appseparator}{\ifenoughspace{5em}{\par{}\vspace{1em}\begin{center}\begin{tikzpicture}\node{\pgfornament[color=unibo,height=3em]{70}};\end{tikzpicture}\end{center}\par{}\vspace{1em}}{}}


\newcommand{\chapterornament}[1]{\ifenoughspace{5em}{\par\vfill\par \begin{center}\begin{tikzpicture}\node{\pgfornament[color=unibo,height=3em]{#1} \pgfornament[color=unibo,height=3em,symmetry=v]{#1}};\end{tikzpicture}\end{center}\par\vfill\par}{}}



\newcommand{\finalornament}{\ifenoughspace{5em}{\par{}\vfill\par{}\begin{center}\begin{tikzpicture}\node{\pgfornament[color=unibo,height=5em]{68}};\end{tikzpicture}\end{center}\par{}\vfill\par{}}{}}

%\newcommand{\endchaporn}[1]{\par{}\begin{center}\begin{tikzpicture}\node{\pgfornament[color=black,height=3em]{#1}};
%\node{\pgfornament[color=black,height=3em]{#1}};
%\end{tikzpicture}\end{center}\par{}}


%%%subappendices
\newenvironment{chapterappendices}[1][Appendices]
{
\section*{#1}
\addcontentsline{toc}{section}{\textcolor{unibo}{\textit{#1}}}
\markright{#1}  
%\counterwithin{figure}{section}
%\counterwithin{table}{section}
\renewcommand\thesubsection{\thechapter.\textsc{\alph{subsection}}}
}
{
%\counterwithout{figure}{section}
%\counterwithout{table}{section}
\renewcommand\thesubsection{subsection}
} 


\usepackage{makecell}

\DeclareMathOperator{\Sf}{S}
\DeclareMathOperator{\Cf}{C}

\DeclareMathVersion{normal2}


\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map[overwrite]{
      \step[fieldsource=doi, final]
      \step[fieldset=url, null]
      \step[fieldset=eprint, null]
    }  
  }
}

\usepackage[activate={true,nocompatibility},final,expansion=false,protrusion=true,tracking=true,kerning=true,spacing=true,factor=1100]{microtype}
 \SetTracking{encoding={*}, shape=sc}{10}
 \microtypecontext{spacing=nonfrench}
 
 \setlength\headheight{15pt}
 
 \usepackage{lettrine}
 
 
 \newcommand{\mylettrine}[2]{\lettrine[lines=4,lhang=.1,findent=.1em,nindent=0em]{\color{unibo}#1}{\textls[100]{\color{unibo}#2}}} 
 
 \usepackage[percent]{overpic}


%%% TOC OPTIONS 
% \usepackage{tocloft}
% \renewcommand{\cftpartpresnum}{Part~}
% \renewcommand{\cftpartaftersnumb}{~\Large{\textcolor{gray75}{|}}\hsps}
% \renewcommand{\cftchapaftersnumb}{~{\textcolor{gray75}{|}}\hsps}

%\usepackage{titletoc}
%\renewcommand*\l@part[2]{%
%  \ifnum \c@tocdepth >-2\relax
%    \addpenalty{-\@highpenalty}%
%    \addvspace{2.25em \@plus\p@}%
%    \setlength\@tempdima{3em}%
%    \begingroup
%      \parindent \z@ \rightskip \@pnumwidth
%      \parfillskip -\@pnumwidth
%      {\leavevmode
%       \large \bfseries Part #1 \hfil
%       \hb@xt@\@pnumwidth{\hss #2% 
%                          \kern-\p@\kern\p@}}\par
%       \nobreak
%         \global\@nobreaktrue
%         \everypar{\global\@nobreakfalse\everypar{}}%
%    \endgroup
%  \fi}

\makeatletter
\def\@part[#1]#2{%
    \ifnum \c@secnumdepth >-2\relax
      \refstepcounter{part}%
      \addcontentsline{toc}{part}{\partname~\thepart\hspace{1em}#1}%
    \else
      \addcontentsline{toc}{part}{#1}%
    \fi
    \markboth{}{}%
    {\centering
     \interlinepenalty \@M
     \normalfont
     \ifnum \c@secnumdepth >-2\relax
       \huge\bfseries \partname\nobreakspace\thepart
       \par
       \vskip 20\p@
     \fi
     \Huge \bfseries #2\par}%
    \@endpart}
\makeatother

\renewbibmacro*{volume+number+eid}{%
  \printfield{volume}%
%  \setunit*{\adddot}% DELETED
%  \setunit*{\addnbthinspace}% NEW (optional); there's also \addnbthinspace
  \printfield{number}%
  \setunit{\addcomma\space}%
  \printfield{eid}}
\DeclareFieldFormat[article]{number}{\mkbibparens{#1}}


\AtBeginBibliography{%
    \DeclareFieldFormat{labelnumberwidth}{%
        {\color{unibo}\mkbibbrackets{#1}}%
    %    {\mkbibbrackets{#1}}%
    }}
    
\renewcommand\footnoterule{\textcolor{unibo}{\kern-3pt \hrule width 2in \kern 2.6pt}}


\renewcommand\thefootnote{\textcolor{unibo}{\arabic{footnote}}}

\usepackage{tocloft}
\renewcommand{\cftdot}{\textcolor{unibo}{.}}
\renewcommand{\cftchapaftersnum}{~\textcolor{unibo}{|}~}